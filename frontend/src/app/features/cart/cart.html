<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Loading State -->
   @if (isLoading()) {
     <div class="flex justify-center py-12">
       <app-loading-spinner></app-loading-spinner>
     </div>
   }

  <!-- Empty Cart -->
   @if (!isLoading() && allCartItems()?.length===0) {
     <div class="text-center py-12">
       <mat-icon class="text-6xl text-gray-300">shopping_cart</mat-icon>
       <h3 class="mt-4 text-xl font-medium text-gray-900">Your cart is empty</h3>
       <p class="mt-2 text-gray-500">Looks like you haven't added any items to your cart yet.</p>
       <button
         (click)="continueShopping()"
         class="mt-4 px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700"
       >
         Continue Shopping
       </button>
     </div>
   }

  <!-- Cart Items -->
   @if (!isLoading() && allCartItems(); as cartItems) {
     <div class="bg-white rounded-lg shadow overflow-hidden">
       <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
         <h3 class="text-lg leading-6 font-medium text-gray-900">Shopping Cart</h3>
         <p class="mt-1 text-sm text-gray-500">Review your items and proceed to checkout</p>
       </div>

       @for (item of cartItems; track $index) {
         <div class="divide-y divide-gray-200">
           <div
             class="p-4 flex flex-col sm:flex-row sm:items-center"
           >
             <div class="flex-shrink-0 h-24 w-24 bg-gray-200 rounded-md overflow-hidden">
               <img [src]="item.productImageUrl" [alt]="item.productName" class="h-full w-full object-cover" />
             </div>
             <div class="mt-4 sm:mt-0 sm:ml-4 flex-grow">
               <h4 class="text-base font-medium text-gray-900">{{ item.productName }}</h4>
               <p class="text-sm text-gray-500 mt-1">{{ item.productPrice |currency:"R"}} each</p>
               <div class="flex items-center mt-2">
                 <button
                   mat-icon-button
                   (click)="updateQty(item.id, item.quantity)"
                   class="hover:bg-gray-100"
                 >
                   <mat-icon>remove</mat-icon>
                 </button>
                 <span class="mx-3 text-sm font-medium">{{ item.quantity }}</span>
                 <button
                   mat-icon-button
                   (click)="updateQuantity(item.id, item.quantity + 1)"
                   class="hover:bg-gray-100"
                 >
                   <mat-icon>add</mat-icon>
                 </button>
                 <button
                   mat-button
                   color="warn"
                   (click)="removeFromCart(item.id)"
                   class="ml-4 text-sm"
                 >
                   Remove
                 </button>
               </div>
             </div>
             <div class="mt-4 sm:mt-0 text-right">
               <p class="text-lg font-bold text-gray-900">{{ cartItemsSummary()?.totalPrice|currency:"R" }}</p>
             </div>
           </div>
         </div>
       }

       <!-- Cart Summary -->
       <div class="bg-gray-50 px-4 py-5 sm:px-6">
         <div class="flex justify-between text-lg font-medium text-gray-900">
           <span>Subtotal ({{ cartItemsSummary()?.cartCount }} items)</span>
           <span>{{ cartItemsSummary()?.totalPrice|currency:"R"}}</span>
         </div>
         <div class="mt-2 text-sm text-gray-500">
           Shipping and taxes calculated at checkout
         </div>
         <div class="mt-6">
           <button
             (click)="proceedToCheckout()"
             [disabled]="cartItems.length === 0"
             class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed"
           >
             Proceed to Checkout
           </button>
         </div>
         <div class="mt-6 flex justify-between">
           <button
             (click)="continueShopping()"
             class="text-sm font-medium text-indigo-600 hover:text-indigo-500"
           >
             Continue Shopping
           </button>

           @if(cartItems.length>0){
             <button
               (click)="clearCart()"
               class="text-sm font-medium text-red-600 hover:text-red-500"
             >
               Clear Cart
             </button>
           }
         </div>
       </div>
     </div>
   }
</div>
